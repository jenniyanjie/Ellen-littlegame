<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<title>Ellen's Sudoku</title>
<style>
  :root {
    --cell-size: min(40px, 9vw);
    --border-color: #394457;
    --bg-color: #f5f5f5;
    --fixed-bg: #e2e8f0;
    --button-bg: #3b82f6;
    --button-hover: #2563eb;
  }
  
  * { box-sizing: border-box; }
  
  body { 
    font-family: system-ui, -apple-system, Arial, sans-serif; 
    text-align: center; 
    background: var(--bg-color);
    margin: 0;
    padding: 16px;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  
  h1 { 
    margin: 16px 0;
    font-size: clamp(24px, 5vw, 32px);
  }
  
  .controls {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    justify-content: center;
    margin-bottom: 16px;
    width: 100%;
    max-width: 400px;
  }
  
  button { 
    flex: 1;
    min-width: 120px;
    padding: 12px;
    font-size: 16px;
    border: none;
    border-radius: 8px;
    background: var(--button-bg);
    color: white;
    cursor: pointer;
    transition: background 0.2s;
  }
  
  button:hover {
    background: var(--button-hover);
  }
  
  table { 
    border-collapse: collapse; 
    margin: 0 auto;
    background: white;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
  
  td {
    border: 1px solid #ddd;
    width: var(--cell-size); 
    height: var(--cell-size);
    text-align: center;
    position: relative;
    padding: 0;
  }
  
  input {
    width: 100%;
    height: 100%;
    text-align: center;
    font-size: calc(var(--cell-size) * 0.5);
    border: none;
    padding: 0;
    background: transparent;
    appearance: none;
    -webkit-appearance: none;
  }
  
  input:focus {
    outline: 2px solid var(--button-bg);
    outline-offset: -2px;
  }
  
  .fixed { 
    background: var(--fixed-bg); 
    font-weight: 600;
  }
  
  /* Style for revealed answer numbers */
  .revealed-answer {
    color: #2563eb;  /* ËìùËâ≤Á≠îÊ°à */
    font-weight: 500;
    font-style: italic;
    background: #eff6ff;  /* Ê∑°ËìùËâ≤ËÉåÊôØ */
  }
  
  /* Style for incorrect numbers */
  .incorrect {
    color: #dc2626;  /* Á∫¢Ëâ≤ÈîôËØØÊï∞Â≠ó */
    background: #fef2f2;  /* Ê∑°Á∫¢Ëâ≤ËÉåÊôØ */
    position: relative;
  }
  
  .incorrect::after {
    content: '√ó';
    position: absolute;
    top: -8px;
    right: 0;
    font-size: 12px;
    color: #dc2626;
    font-weight: bold;
  }
  
  .thick-right { 
    border-right: 3px solid var(--border-color); 
  }
  
  .thick-bottom { 
    border-bottom: 3px solid var(--border-color); 
  }
  
  #message {
    margin: 16px 0;
    min-height: 24px;
    font-size: 16px;
  }
  
  @media (max-width: 480px) {
    body {
      padding: 8px;
    }
    
    .controls {
      padding: 0 8px;
    }
    
    button {
      padding: 10px;
      min-width: 100px;
      font-size: 14px;
    }
    
    input {
      font-size: calc(var(--cell-size) * 0.6);
    }
  }
  
  @media (min-width: 768px) {
    :root {
      --cell-size: 44px;
    }
  }
</style>
</head>
<body>
<h1>9√ó9 Sudoku Game</h1>
<div class="controls">
  <button onclick="generateSudoku()">New Game</button>
  <button onclick="checkSudoku()">Check Answer</button>
  <button onclick="revealAnswer()">Peek Answer</button>
</div>
<table id="sudoku"></table>
<p id="message"></p>

<script>
function createEmptyBoard() {
  return Array.from({ length: 9 }, () => Array(9).fill(0));
}

function isSafe(board, row, col, num) {
  for (let i = 0; i < 9; i++) {
    if (board[row][i] === num || board[i][col] === num) return false;
  }
  let startRow = Math.floor(row / 3) * 3;
  let startCol = Math.floor(col / 3) * 3;
  for (let r = 0; r < 3; r++) {
    for (let c = 0; c < 3; c++) {
      if (board[startRow + r][startCol + c] === num) return false;
    }
  }
  return true;
}

function solveBoard(board) {
  for (let row = 0; row < 9; row++) {
    for (let col = 0; col < 9; col++) {
      if (board[row][col] === 0) {
        let nums = [1,2,3,4,5,6,7,8,9];
        nums.sort(() => Math.random() - 0.5);
        for (let num of nums) {
          if (isSafe(board, row, col, num)) {
            board[row][col] = num;
            if (solveBoard(board)) return true;
            board[row][col] = 0;
          }
        }
        return false;
      }
    }
  }
  return true;
}

function generateFullSudoku() {
  let board = createEmptyBoard();
  solveBoard(board);
  return board;
}

function generatePuzzle(fullBoard, clues = 35) {
  let puzzle = fullBoard.map(row => row.slice());
  let removeCount = 81 - clues;
  while (removeCount > 0) {
    let r = Math.floor(Math.random() * 9);
    let c = Math.floor(Math.random() * 9);
    if (puzzle[r][c] !== 0) {
      puzzle[r][c] = 0;
      removeCount--;
    }
  }
  return puzzle;
}

let solutionBoard = null;
let puzzleBoard = null;

function renderBoard(puzzle) {
  const table = document.getElementById('sudoku');
  table.innerHTML = '';
  for (let r = 0; r < 9; r++) {
    let tr = document.createElement('tr');
    for (let c = 0; c < 9; c++) {
      let td = document.createElement('td');
      if ((c+1) % 3 === 0 && c < 8) td.classList.add('thick-right');
      if ((r+1) % 3 === 0 && r < 8) td.classList.add('thick-bottom');

      if (puzzle[r][c] !== 0) {
        td.innerHTML = `<input type="text" value="${puzzle[r][c]}" readonly class="fixed">`;
      } else {
        td.innerHTML = `<input type="text" maxlength="1" oninput="this.value=this.value.replace(/[^1-9]/,'')">`;
      }
      tr.appendChild(td);
    }
    table.appendChild(tr);
  }
}

function generateSudoku() {
  const full = generateFullSudoku();
  const puzzle = generatePuzzle(full, 35);
  solutionBoard = full;
  puzzleBoard = puzzle;
  renderBoard(puzzle);
  document.getElementById('message').textContent = '';
  
  // Reset peek answer state
  isShowingAnswer = false;
  originalPuzzle = null;
  const peekButton = document.querySelector('button[onclick="revealAnswer()"]');
  peekButton.textContent = 'Peek Answer';
  peekButton.style.background = '';
  
  // Clear any incorrect marks
  document.querySelectorAll('.incorrect').forEach(cell => {
    cell.classList.remove('incorrect');
  });
}

function checkSudoku() {
  let table = document.getElementById('sudoku');
  let hasError = false;
  let filledCount = 0;
  let totalCells = 81;
  
  // ÂÖàÊ∏ÖÈô§ÊâÄÊúâ‰πãÂâçÁöÑÈîôËØØÊ†áËÆ∞
  document.querySelectorAll('.incorrect').forEach(cell => {
    cell.classList.remove('incorrect');
  });
  
  // Ê£ÄÊü•ÊâÄÊúâÂ∑≤Â°´ÂÖ•ÁöÑÊï∞Â≠ó
  for (let r = 0; r < 9; r++) {
    for (let c = 0; c < 9; c++) {
      let cell = table.rows[r].cells[c].querySelector('input');
      let val = cell.value.trim();
      
      // Ë∑≥ËøáÁ©∫Ê†º
      if (!val) continue;
      
      filledCount++;
      val = parseInt(val);
      
      // Ê£ÄÊü•Êï∞Â≠óÊòØÂê¶Ê≠£Á°Æ
      if (val !== solutionBoard[r][c]) {
        cell.classList.add('incorrect');
        hasError = true;
      }
    }
  }
  
  // Êõ¥Êñ∞Ê∂àÊÅØ
  const msgEl = document.getElementById('message');
  if (filledCount === 0) {
    msgEl.textContent = '‚ùó Please fill in some numbers first!';
  } else if (hasError) {
    msgEl.textContent = `‚ùå Found ${document.querySelectorAll('.incorrect').length} incorrect numbers`;
  } else if (filledCount < totalCells) {
    msgEl.textContent = `‚úÖ All ${filledCount} numbers correct, ${totalCells - filledCount} to go!`;
  } else {
    msgEl.textContent = 'üéâ Congratulations, well done!';
  }
}

// Store original puzzle state
let originalPuzzle = null;
let isShowingAnswer = false;

// Toggle between "Peek Answer" and "Continue Game"
function revealAnswer() {
  const table = document.getElementById('sudoku');
  const peekButton = document.querySelector('button[onclick="revealAnswer()"]');
  
  if (!isShowingAnswer) {
    // Save current game state
    originalPuzzle = Array(9).fill().map(() => Array(9).fill(0));
    for (let r = 0; r < 9; r++) {
      for (let c = 0; c < 9; c++) {
        let cell = table.rows[r].cells[c].querySelector('input');
        originalPuzzle[r][c] = {
          value: cell.value,
          readOnly: cell.readOnly,
          isFixed: cell.classList.contains('fixed')
        };
      }
    }
    
    // Show answer
    for (let r = 0; r < 9; r++) {
      for (let c = 0; c < 9; c++) {
        let cell = table.rows[r].cells[c].querySelector('input');
        // Â¶ÇÊûú‰∏çÊòØÂéüÂßãÊï∞Â≠óÔºå‰ΩøÁî®ÁâπÊÆäÊ†∑ÂºèÊòæÁ§∫Á≠îÊ°à
        if (!cell.classList.contains('fixed')) {
          cell.value = solutionBoard[r][c];
          cell.readOnly = true;
          cell.classList.add('revealed-answer');
        }
      }
    }
    document.getElementById('message').textContent = 'üîç Answer revealed!';
    peekButton.textContent = 'Continue';
    peekButton.style.background = 'var(--button-hover)';
  } else {
    // Restore original game state
    for (let r = 0; r < 9; r++) {
      for (let c = 0; c < 9; c++) {
        let cell = table.rows[r].cells[c].querySelector('input');
        let original = originalPuzzle[r][c];
        cell.value = original.value;
        cell.readOnly = original.readOnly;
        cell.classList.remove('revealed-answer');
        if (!original.isFixed) {
          cell.classList.remove('fixed');
        }
      }
    }
    document.getElementById('message').textContent = '';
    peekButton.textContent = 'Peek Answer';
    peekButton.style.background = '';
  }
  
  isShowingAnswer = !isShowingAnswer;
}

generateSudoku();
</script>
</body>
</html>


